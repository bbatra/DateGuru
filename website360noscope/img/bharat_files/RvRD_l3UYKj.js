/*!CK:3032247219!*//*1414989207,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Eff5J"]); }

__d("CavalryLoggerImpl",["Arbiter","Banzai","DOMQuery","ISB","Run","copyProperties","performance","performanceAbsoluteNow"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o='cavalry',p=window.CavalryLogger;function q(){var v=0,w=document.styleSheets;for(var x=0;x<w.length;x++){var y=w[x].cssRules||w[x].rules||[];v+=y.length;}return v;}function r(v){var w=i.scry(document,'img[src]'),x=0;for(var y=0;y<w.length;y++){var z=w[y].getAttribute('src');if(z.match(v))x++;}return x;}function s(){return document.getElementsByTagName('*').length;}function t(){var v=[document],w=1;while(v.length&&w<20000){var x=v.pop();for(var y=0;y<x.childNodes.length;y++){v.push(x.childNodes[y]);w++;}}return w;}function u(){return document.body.innerHTML.length;}l(p.prototype,{initializeInstrumentation:function(){if(this.instrumentation_started)return;m.setResourceTimingBufferSize&&m.setResourceTimingBufferSize(700);m.webkitSetResourceTimingBufferSize&&m.webkitSetResourceTimingBufferSize(700);var v=this;g.subscribe('BigPipe/init',function(event,w){if((w.lid==v.lid)&&w.arbiter){v.recordTTIEvent(w.arbiter);v.recordPageletEvents(w.arbiter);}});k.onAfterLoad(function(){v.addPiggyback('cjs_factory_count_afterload',b.__getTotalFactories()).addPiggyback('cjs_factory_time_afterload',b.__getFactoryTime());});this.instrumentation_started=true;},recordTTIEvent:function(v){var w=this;v.subscribe('tti_bigpipe',function(event,x){if(x.lid==w.lid)w.setTTIPhase(x.phase).addPiggyback('cjs_factory_count_tti',b.__getTotalFactories()).addPiggyback('cjs_factory_time_tti',b.__getFactoryTime()).measurePageLoad(true,x.ts);});},recordPageletEvents:function(v){if(this.is_detailed_profiler){var w=this;v.subscribe('pagelet_event',function(event,x){if(x.lid==w.lid){w.onPageletEvent(x.event,x.id,x.ts);if(x.event=='arrive'){w.events[x.id].phase=x.phase;w.setDatedTimeStamp('t_pagelet_phase_'+x.id+'_'+x.phase,x.ts);}if((x.event==='onload'||x.event==='display')&&x.categories)x.categories.forEach(function(y){w.setDatedTimeStamp('t_pagelet_category_'+y+'_'+x.event,x.ts,true);});}});v.subscribe('phase_begin',function(event,x){if(x.lid==w.lid)w.setDatedTimeStamp('t_phase_begin_'+x.phase,x.ts);});}},setTTIPhase:function(v){this.addPiggyback('tti_phase',v);return this;},setTransition:function(v){this.transition=v;return this;},setTimeStamp:function(v,w,x,y){var z=this.values.t_cstart||this.values.t_start,aa=y?(z+y):n();this.setValue(v,aa,w,x);if(this.tti_event&&v==this.tti_event)this.measurePageLoad(w);return this;},setDatedTimeStamp:function(v,w,x,y){this.setValue(v,w,x,y);if(this.tti_event&&v==this.tti_event)this.measurePageLoad(x,w);return this;},log:function(v){var w={lid:this.lid};if(j.token)w.fb_isb=j.token;var x=['t_start','t_paint','t_cstart'],y;for(y=0;y<x.length;y++){var z=x[y];w[z]=this.values[z];delete this.values[z];}var aa=l({cseq:'1/1',t_creport:n()},w);l(aa,this.values);l(aa,this.piggy_values);h.post(o,aa,h.VITAL);this.piggy_values={};g.inform('cavalry_log_sent',this.lid,g.BEHAVIOR_EVENT);},logPiggybacks:function(){var v=l({lid:this.lid},this.piggy_values);this.piggy_values={};h.post(o,v,h.VITAL);},onPageletEvent:function(v,w,x){this.events[w]=this.events[w]||{};this.events[w][v]=x-window._cstart;var y={display_start:'t_pagelet_displaystart_',display:'t_pagelet_display_',jsstart:'t_pagelet_jsstart_',jsdone:'t_pagelet_jsdone_',preonload:'t_pagelet_preonload_',onload:'t_pagelet_done_',css:'t_pagelet_start_',css_load:'t_pagelet_cssload_',arrive:'t_pagelet_arrive_',setup:'t_pagelet_setup_'};this.setDatedTimeStamp(y[v]+w,x);},collectMetrics:function(v){if(!this.metric_collected||!!v){this.metric_collected=true;this.addPiggyback('dom',t);this.addPiggyback('tag',s);this.addPiggyback('css',q);this.addPiggyback('htmlsize_client',u);this.addPiggyback('photo',r,/photos.*(fbcdn.net|facebook.com)\//);this.addPiggyback('profile',r,/profile.*(fbcdn.net|facebook.com)\//);}},measurePageLoad:function(v,w){if(!!w){this.setDatedTimeStamp('t_tti',w,v);}else this.setTimeStamp('t_tti',v);this.collectMetrics(v);if(this.transition)alert('tti measured:'+this.lid);},collectBrowserTiming:function(v){if(m.timing){var w=-v._cstart;this.collectTiming("tp_",m.timing,w);this.collectResourceTiming(v);}},collectTimingForAsync:function(v,w){if(!w)return;if(m.timing&&m.getEntriesByName){var x=m.getEntriesByName(w);if(x.length===0)return;var y=m.timing.navigationStart-v._cstart;this.collectTiming("tp_",x[0],y);}},collectResourceTiming:function(v){if(!m.timing||!m.getEntriesByType||!this.log_resources)return;var w=m.timing.navigationStart-v._cstart,x=m.getEntriesByType("resource"),y=v.Bootloader?v.Bootloader.__debug.resources:[],z={};for(var aa in y)z[y[aa].src]=aa;for(aa=0;aa<x.length;aa++){var ba=x[aa];if(ba.duration<=0)continue;var ca=ba.initiatorType;if(ca!="script"&&ca!="link"&&ca!="css")continue;var da=/\/rsrc\.php\/.*\/([^\?/]*)(\?.*)?$/,ea=ba.name.match(da);if(!ea||!ea[1])continue;var fa=z[ba.name]||"unk";this.collectTiming("t_rsrc_"+fa+"_"+ea[1]+"_",ba,w);}},collectTiming:function(v,w,x){var y=['connectEnd','connectStart','domComplete','domContentLoadedEventEnd','domContentLoadedEventStart','domInteractive','domLoading','domainLookupEnd','domainLookupStart','fetchStart','loadEventEnd','loadEventStart','navigationStart','redirectEnd','redirectStart','requestStart','responseEnd','responseStart','secureConnectionStart','startTime','unloadEventEnd','unloadEventStart'];for(var z=0;z<y.length;z++){var aa=y[z];if(w[aa]){var ba=v+aa,ca=w[aa]+x;this.setTimeStamp(ba,true,null,ca);}}}});l(p,{startInstrumentation:function(){for(var v in p.instances){var w=p.instances[v];w.initializeInstrumentation();if('t_tti' in w.values)w.measurePageLoad(false,w.values.t_tti);}}});e.exports=p;},null);